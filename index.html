<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>French Departments Flashcards</title>

    <!-- Emoji favicon -->
    <link
    rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🇫🇷</text></svg>"
    >
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0055A4 0%, #EF4135 50%, #FFFFFF 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #0055A4;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            color: #718096;
            font-size: 1.1em;
        }

        .settings-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .question-types {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .question-type-btn {
            padding: 10px 15px;
            border: 2px solid #0055A4;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .question-type-btn.active {
            background: #0055A4;
            color: white;
        }

        .question-type-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 85, 164, 0.2);
        }

        .progress-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0055A4, #EF4135);
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: #f7fafc;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #0055A4;
        }

        .stat-number {
            font-size: 1.8em;
            font-weight: bold;
            color: #4a5568;
        }

        .stat-label {
            font-size: 0.9em;
            color: #718096;
        }

        .flashcard {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .question {
            font-size: 1.8em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 30px;
        }

        .department-shape-container {
            width: 400px;
            height: 400px;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .department-shape-svg {
            width: 100%;
            height: 100%;
        }

        .department-shape-svg path {
            fill: #0055A4;
            stroke: #003d7a;
            stroke-width: 2;
            transition: fill 0.3s ease;
        }

        .department-shape-svg path:hover {
            fill: #EF4135;
        }

        .answer-section {
            margin: 20px 0;
        }

        .answer-input {
            width: 100%;
            max-width: 500px;
            padding: 15px;
            font-size: 1.2em;
            border: 3px solid #e2e8f0;
            border-radius: 10px;
            margin-bottom: 20px;
            transition: border-color 0.3s ease;
        }

        .answer-input:focus {
            outline: none;
            border-color: #0055A4;
            box-shadow: 0 0 0 3px rgba(0, 85, 164, 0.1);
        }

        .answer-input.correct {
            border-color: #38a169;
            background-color: #f0fff4;
        }

        .answer-input.incorrect {
            border-color: #e53e3e;
            background-color: #fff5f5;
        }

        .result {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 1.1em;
            font-weight: bold;
        }

        .result.correct {
            background: #f0fff4;
            color: #38a169;
            border: 2px solid #68d391;
        }

        .result.incorrect {
            background: #fff5f5;
            color: #e53e3e;
            border: 2px solid #fc8181;
        }

        .confidence-section {
            margin: 20px 0;
        }

        .confidence-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .confidence-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .confidence-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .confidence-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .confidence-1 { background: #fed7d7; color: #c53030; }
        .confidence-2 { background: #feebc8; color: #dd6b20; }
        .confidence-3 { background: #fefcbf; color: #d69e2e; }
        .confidence-4 { background: #c6f6d5; color: #38a169; }
        .confidence-5 { background: #bee3f8; color: #3182ce; }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(45deg, #0055A4, #003d7a);
            color: white;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-success {
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
        }

        .completion-message {
            text-align: center;
            padding: 30px;
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .completion-message h2 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #718096;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .question {
                font-size: 1.3em;
            }
            
            .confidence-buttons {
                flex-direction: column;
            }
            
            .confidence-btn {
                width: 100%;
            }

            .department-shape-container {
                width: 300px;
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🇫🇷 French Departments Flashcards 🇫🇷</h1>
            <p>Learn the departments, their capitals, and their shapes</p>
        </div>

        <div class="settings-section">
            <h3>Question Types:</h3>
            <div class="question-types">
                <button class="question-type-btn active" data-type="name-to-capital">Department → Capital</button>
                <button class="question-type-btn active" data-type="capital-to-name">Capital → Department</button>
                <button class="question-type-btn active" data-type="shape-to-name">Shape → Department</button>
            </div>
        </div>

        <div class="progress-section">
            <h3>Progress</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <p id="progressText">Mastered: 0/288 (0%)</p>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="stat1">0</div>
                    <div class="stat-label">Level 1</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat2">0</div>
                    <div class="stat-label">Level 2</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat3">0</div>
                    <div class="stat-label">Level 3</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat4">0</div>
                    <div class="stat-label">Level 4</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat5">0</div>
                    <div class="stat-label">Level 5</div>
                </div>
            </div>
        </div>

        <div class="completion-message hidden" id="completionMessage">
            <h2>🎉 Congratulations! 🎉</h2>
            <p>You've mastered all the French departments!</p>
            <button class="btn btn-success" onclick="startSession()">Start Over</button>
        </div>

        <div class="flashcard" id="flashcardSection">
            <div class="loading" id="loadingMessage">Loading map data...</div>
            <div class="hidden" id="mainContent">
                <div class="question" id="currentQuestion">Click "Start" to begin</div>
                <div id="imageContainer"></div>
                <div class="answer-section">
                    <input type="text" id="answerInput" class="answer-input" placeholder="Type the correct answer..." autocomplete="off">
                    <div id="resultSection" class="hidden"></div>
                </div>
                <div class="confidence-section">
                    <p><strong>Rate your confidence (after answering correctly):</strong></p>
                    <div class="confidence-buttons">
                        <button class="confidence-btn confidence-1" onclick="setConfidence(1)" id="dontKnowBtn">1 - Don't know</button>
                        <button class="confidence-btn confidence-2" onclick="setConfidence(2)" disabled>2 - Very uncertain</button>
                        <button class="confidence-btn confidence-3" onclick="setConfidence(3)" disabled>3 - Somewhat confident</button>
                        <button class="confidence-btn confidence-4" onclick="setConfidence(4)" disabled>4 - Quite confident</button>
                        <button class="confidence-btn confidence-5" onclick="setConfidence(5)" disabled>5 - Completely confident</button>
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" id="checkBtn" onclick="checkAnswer()">Check Answer</button>
                </div>
            </div>
        </div>

        <footer style="background: rgba(255, 255, 255, 0.95); padding: 20px; border-radius: 15px; margin-top: 30px; text-align: center; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);">
            <p style="color: #718096; font-size: 0.9em; margin: 0;">
                Department maps provided by <a href="https://github.com/VictorCazanave/svg-maps" target="_blank" rel="noopener noreferrer" style="color: #0055A4; text-decoration: none; font-weight: bold;">@svg-maps/france.departments</a>
                • Licensed under <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener noreferrer" style="color: #0055A4; text-decoration: none;">CC BY 4.0</a>
            </p>
        </footer>
    </div>

    <script type="module">
        // Load the France departments map from CDN
        import franceDepartments from 'https://cdn.jsdelivr.net/npm/@svg-maps/france.departments@1.0.1/+esm';
        
        class FrenchDepartmentsFlashcards {
            constructor(mapData) {
                this.mapData = mapData;
                
                // French departments data (Metropolitan France)
                this.departments = {"Ain":{"capital":"Bourg-en-Bresse","number":"01"},"Aisne":{"capital":"Laon","number":"02"},"Allier":{"capital":"Moulins","number":"03"},"Alpes-de-Haute-Provence":{"capital":"Digne-les-Bains","number":"04"},"Hautes-Alpes":{"capital":"Gap","number":"05"},"Alpes-Maritimes":{"capital":"Nice","number":"06"},"Ardèche":{"capital":"Privas","number":"07"},"Ardennes":{"capital":"Charleville-Mézières","number":"08"},"Ariège":{"capital":"Foix","number":"09"},"Aube":{"capital":"Troyes","number":"10"},"Aude":{"capital":"Carcassonne","number":"11"},"Aveyron":{"capital":"Rodez","number":"12"},"Bouches-du-Rhône":{"capital":"Marseille","number":"13"},"Calvados":{"capital":"Caen","number":"14"},"Cantal":{"capital":"Aurillac","number":"15"},"Charente":{"capital":"Angoulême","number":"16"},"Charente-Maritime":{"capital":"La Rochelle","number":"17"},"Cher":{"capital":"Bourges","number":"18"},"Corrèze":{"capital":"Tulle","number":"19"},"Côte-d'Or":{"capital":"Dijon","number":"21"},"Côtes-d'Armor":{"capital":"Saint-Brieuc","number":"22"},"Creuse":{"capital":"Guéret","number":"23"},"Dordogne":{"capital":"Périgueux","number":"24"},"Doubs":{"capital":"Besançon","number":"25"},"Drôme":{"capital":"Valence","number":"26"},"Eure":{"capital":"Évreux","number":"27"},"Eure-et-Loir":{"capital":"Chartres","number":"28"},"Finistère":{"capital":"Quimper","number":"29"},"Corse-du-Sud":{"capital":"Ajaccio","number":"2A"},"Haute-Corse":{"capital":"Bastia","number":"2B"},"Gard":{"capital":"Nîmes","number":"30"},"Haute-Garonne":{"capital":"Toulouse","number":"31"},"Gers":{"capital":"Auch","number":"32"},"Gironde":{"capital":"Bordeaux","number":"33"},"Hérault":{"capital":"Montpellier","number":"34"},"Ille-et-Vilaine":{"capital":"Rennes","number":"35"},"Indre":{"capital":"Châteauroux","number":"36"},"Indre-et-Loire":{"capital":"Tours","number":"37"},"Isère":{"capital":"Grenoble","number":"38"},"Jura":{"capital":"Lons-le-Saunier","number":"39"},"Landes":{"capital":"Mont-de-Marsan","number":"40"},"Loir-et-Cher":{"capital":"Blois","number":"41"},"Loire":{"capital":"Saint-Étienne","number":"42"},"Haute-Loire":{"capital":"Le Puy-en-Velay","number":"43"},"Loire-Atlantique":{"capital":"Nantes","number":"44"},"Loiret":{"capital":"Orléans","number":"45"},"Lot":{"capital":"Cahors","number":"46"},"Lot-et-Garonne":{"capital":"Agen","number":"47"},"Lozère":{"capital":"Mende","number":"48"},"Maine-et-Loire":{"capital":"Angers","number":"49"},"Manche":{"capital":"Saint-Lô","number":"50"},"Marne":{"capital":"Châlons-en-Champagne","number":"51"},"Haute-Marne":{"capital":"Chaumont","number":"52"},"Mayenne":{"capital":"Laval","number":"53"},"Meurthe-et-Moselle":{"capital":"Nancy","number":"54"},"Meuse":{"capital":"Bar-le-Duc","number":"55"},"Morbihan":{"capital":"Vannes","number":"56"},"Moselle":{"capital":"Metz","number":"57"},"Nièvre":{"capital":"Nevers","number":"58"},"Nord":{"capital":"Lille","number":"59"},"Oise":{"capital":"Beauvais","number":"60"},"Orne":{"capital":"Alençon","number":"61"},"Pas-de-Calais":{"capital":"Arras","number":"62"},"Puy-de-Dôme":{"capital":"Clermont-Ferrand","number":"63"},"Pyrénées-Atlantiques":{"capital":"Pau","number":"64"},"Hautes-Pyrénées":{"capital":"Tarbes","number":"65"},"Pyrénées-Orientales":{"capital":"Perpignan","number":"66"},"Bas-Rhin":{"capital":"Strasbourg","number":"67"},"Haut-Rhin":{"capital":"Colmar","number":"68"},"Rhône":{"capital":"Lyon","number":"69"},"Haute-Saône":{"capital":"Vesoul","number":"70"},"Saône-et-Loire":{"capital":"Mâcon","number":"71"},"Sarthe":{"capital":"Le Mans","number":"72"},"Savoie":{"capital":"Chambéry","number":"73"},"Haute-Savoie":{"capital":"Annecy","number":"74"},"Paris":{"capital":"Paris","number":"75"},"Seine-Maritime":{"capital":"Rouen","number":"76"},"Seine-et-Marne":{"capital":"Melun","number":"77"},"Yvelines":{"capital":"Versailles","number":"78"},"Deux-Sèvres":{"capital":"Niort","number":"79"},"Somme":{"capital":"Amiens","number":"80"},"Tarn":{"capital":"Albi","number":"81"},"Tarn-et-Garonne":{"capital":"Montauban","number":"82"},"Var":{"capital":"Toulon","number":"83"},"Vaucluse":{"capital":"Avignon","number":"84"},"Vendée":{"capital":"La Roche-sur-Yon","number":"85"},"Vienne":{"capital":"Poitiers","number":"86"},"Haute-Vienne":{"capital":"Limoges","number":"87"},"Vosges":{"capital":"Épinal","number":"88"},"Yonne":{"capital":"Auxerre","number":"89"},"Territoire de Belfort":{"capital":"Belfort","number":"90"},"Essonne":{"capital":"Évry-Courcouronnes","number":"91"},"Hauts-de-Seine":{"capital":"Nanterre","number":"92"},"Seine-Saint-Denis":{"capital":"Bobigny","number":"93"},"Val-de-Marne":{"capital":"Créteil","number":"94"},"Val-d'Oise":{"capital":"Cergy","number":"95"}};

                // Phonetic pronunciations for English speakers
                this.phonetics = {
                    "Ain": "an",
                    "Aisne": "EN",
                    "Allier": "al-YAY",
                    "Alpes-de-Haute-Provence": "alp duh OHT pro-VAHNS",
                    "Hautes-Alpes": "oht ALP",
                    "Alpes-Maritimes": "alp mah-ree-TEEM",
                    "Ardèche": "ar-DESH",
                    "Ardennes": "ar-DEN",
                    "Ariège": "ah-ree-EZHE",
                    "Aube": "OHB",
                    "Aude": "OHD",
                    "Aveyron": "ah-vay-ROHN",
                    "Bouches-du-Rhône": "boosh doo ROHN",
                    "Calvados": "kal-vah-DOHS",
                    "Cantal": "kahn-TAL",
                    "Charente": "shah-RAHNT",
                    "Charente-Maritime": "shah-rahnt mah-ree-TEEM",
                    "Cher": "SHAIR",
                    "Corrèze": "koh-REZ",
                    "Côte-d'Or": "koht DOR",
                    "Côtes-d'Armor": "koht dar-MOR",
                    "Creuse": "KRUHZ",
                    "Dordogne": "dor-DON-yuh",
                    "Doubs": "DOO",
                    "Drôme": "DROHM",
                    "Eure": "UHR",
                    "Eure-et-Loir": "uhr ay LWAR",
                    "Finistère": "fee-nee-STAIR",
                    "Corse-du-Sud": "kors doo SOOD",
                    "Haute-Corse": "oht KORS",
                    "Gard": "GAR",
                    "Haute-Garonne": "oht gah-RON",
                    "Gers": "ZHAIR",
                    "Gironde": "zhee-ROHND",
                    "Hérault": "ay-ROH",
                    "Ille-et-Vilaine": "eel ay vee-LEN",
                    "Indre": "AN-druh",
                    "Indre-et-Loire": "an-druh ay LWAR",
                    "Isère": "ee-ZAIR",
                    "Jura": "zhoo-RAH",
                    "Landes": "LAHND",
                    "Loir-et-Cher": "lwar ay SHAIR",
                    "Loire": "LWAR",
                    "Haute-Loire": "oht LWAR",
                    "Loire-Atlantique": "lwar at-lahn-TEEK",
                    "Loiret": "lwar-AY",
                    "Lot": "LOT",
                    "Lot-et-Garonne": "lot ay gah-RON",
                    "Lozère": "loh-ZAIR",
                    "Maine-et-Loire": "men ay LWAR",
                    "Manche": "MAHNSH",
                    "Marne": "MARN",
                    "Haute-Marne": "oht MARN",
                    "Mayenne": "my-EN",
                    "Meurthe-et-Moselle": "MUHRT ay moh-ZEL",
                    "Meuse": "MUHZ",
                    "Morbihan": "mor-bee-AHN",
                    "Moselle": "moh-ZEL",
                    "Nièvre": "nee-EV-ruh",
                    "Nord": "NOR",
                    "Oise": "WAZ",
                    "Orne": "ORN",
                    "Pas-de-Calais": "pah duh kah-LAY",
                    "Puy-de-Dôme": "pwee duh DOME",
                    "Pyrénées-Atlantiques": "peer-ay-nay at-lahn-TEEK",
                    "Hautes-Pyrénées": "oht peer-ay-NAY",
                    "Pyrénées-Orientales": "peer-ay-nay or-ee-ahn-TAL",
                    "Bas-Rhin": "bah RAN",
                    "Haut-Rhin": "oh RAN",
                    "Rhône": "ROHN",
                    "Haute-Saône": "oht SOHN",
                    "Saône-et-Loire": "sohn ay LWAR",
                    "Sarthe": "SART",
                    "Savoie": "sah-VWA",
                    "Haute-Savoie": "oht sah-VWA",
                    "Paris": "pah-REE",
                    "Seine-Maritime": "sen mah-ree-TEEM",
                    "Seine-et-Marne": "sen ay MARN",
                    "Yvelines": "eev-LEEN",
                    "Deux-Sèvres": "duh SEV-ruh",
                    "Somme": "SUM",
                    "Tarn": "TARN",
                    "Tarn-et-Garonne": "tarn ay gah-RON",
                    "Var": "VAR",
                    "Vaucluse": "voh-KLOOZ",
                    "Vendée": "vahn-DAY",
                    "Vienne": "vee-EN",
                    "Haute-Vienne": "oht vee-EN",
                    "Vosges": "VOZH",
                    "Yonne": "YON",
                    "Territoire de Belfort": "tair-ee-TWAR duh bel-FOR",
                    "Essonne": "eh-SON",
                    "Hauts-de-Seine": "oh duh SEN",
                    "Seine-Saint-Denis": "sen san duh-NEE",
                    "Val-de-Marne": "val duh MARN",
                    "Val-d'Oise": "val DWAZ",
                    "Bourg-en-Bresse": "boor ahn BRES",
                    "Laon": "LAHN",
                    "Moulins": "moo-LAN",
                    "Digne-les-Bains": "DEEN-yuh lay BAN",
                    "Gap": "GAP",
                    "Nice": "NEES",
                    "Privas": "pree-VAH",
                    "Charleville-Mézières": "shar-luh-VEEL may-zee-AIR",
                    "Foix": "FWA",
                    "Troyes": "TRWA",
                    "Carcassonne": "kar-kah-SON",
                    "Rodez": "roh-DEZ",
                    "Marseille": "mar-SAY",
                    "Caen": "KAHN",
                    "Aurillac": "oh-ree-YAK",
                    "Angoulême": "ahn-goo-LEM",
                    "La Rochelle": "lah roh-SHEL",
                    "Bourges": "BOORZH",
                    "Tulle": "TOOL",
                    "Dijon": "dee-ZHOHN",
                    "Saint-Brieuc": "san bree-UH",
                    "Guéret": "gay-RAY",
                    "Périgueux": "pay-ree-GUH",
                    "Besançon": "buh-zahn-SOHN",
                    "Valence": "vah-LAHNS",
                    "Évreux": "ay-VRUH",
                    "Chartres": "SHAR-truh",
                    "Quimper": "kam-PAIR",
                    "Ajaccio": "ah-YAH-choh",
                    "Bastia": "bah-STEE-ah",
                    "Nîmes": "NEEM",
                    "Toulouse": "too-LOOZ",
                    "Auch": "OHSH",
                    "Bordeaux": "bor-DOH",
                    "Montpellier": "mohn-pell-YAY",
                    "Rennes": "REN",
                    "Châteauroux": "shah-toh-ROO",
                    "Tours": "TOOR",
                    "Grenoble": "gruh-NOH-bluh",
                    "Lons-le-Saunier": "lohn luh soh-NYAY",
                    "Mont-de-Marsan": "mohn duh mar-SAHN",
                    "Blois": "BLWA",
                    "Saint-Étienne": "sant ay-tee-EN",
                    "Le Puy-en-Velay": "luh pwee ahn vuh-LAY",
                    "Nantes": "NAHNT",
                    "Orléans": "or-lay-AHN",
                    "Cahors": "kah-OR",
                    "Agen": "ah-ZHAN",
                    "Mende": "MAHND",
                    "Angers": "ahn-ZHAY",
                    "Saint-Lô": "san LOH",
                    "Châlons-en-Champagne": "shah-lohn ahn shahm-PAN-yuh",
                    "Chaumont": "shoh-MOHN",
                    "Laval": "lah-VAL",
                    "Nancy": "nahn-SEE",
                    "Bar-le-Duc": "bar luh DOOK",
                    "Vannes": "VAN",
                    "Metz": "MES",
                    "Nevers": "nuh-VAIR",
                    "Lille": "LEEL",
                    "Beauvais": "boh-VAY",
                    "Alençon": "ah-lahn-SOHN",
                    "Arras": "ah-RAHS",
                    "Clermont-Ferrand": "klehr-mohn feh-RAHN",
                    "Pau": "POH",
                    "Tarbes": "TARB",
                    "Perpignan": "pair-peen-YAHN",
                    "Strasbourg": "STRAHS-boor",
                    "Colmar": "kol-MAR",
                    "Lyon": "lee-OHN",
                    "Vesoul": "vuh-ZOOL",
                    "Mâcon": "mah-KOHN",
                    "Le Mans": "luh MAHN",
                    "Chambéry": "shahm-bay-REE",
                    "Annecy": "an-see",
                    "Rouen": "roo-AHN",
                    "Melun": "muh-LAN",
                    "Versailles": "vair-SIGH",
                    "Niort": "nee-OR",
                    "Amiens": "ah-mee-AN",
                    "Albi": "al-BEE",
                    "Montauban": "mohn-toh-BAHN",
                    "Toulon": "too-LOHN",
                    "Avignon": "ah-veen-YOHN",
                    "La Roche-sur-Yon": "lah ROSH soor YON",
                    "Poitiers": "pwah-tee-AY",
                    "Limoges": "lee-MOHZH",
                    "Épinal": "ay-pee-NAL",
                    "Auxerre": "oh-SAIR",
                    "Belfort": "bel-FOR",
                    "Évry-Courcouronnes": "ay-vree koor-koo-RON",
                    "Nanterre": "nahn-TAIR",
                    "Bobigny": "boh-been-YEE",
                    "Créteil": "kray-TAY",
                    "Cergy": "sair-ZHEE"
                };

                // Create map from department name to SVG path
                this.departmentPaths = {};
                if (this.mapData && this.mapData.locations) {
                    this.mapData.locations.forEach(location => {
                        this.departmentPaths[location.name] = location.path;
                    });
                }

                this.enabledQuestionTypes = new Set(['name-to-capital', 'capital-to-name', 'shape-to-name']);
                this.confidenceScores = this.loadProgress();
                this.currentQuestion = null;
                this.isCorrect = false;
                this.recentQuestions = [];
                this.totalQuestions = Object.keys(this.departments).length * this.enabledQuestionTypes.size;
                
                this.setupQuestionTypeButtons();
                this.updateProgress();
                
                document.getElementById('loadingMessage').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
            }

            setupQuestionTypeButtons() {
                const buttons = document.querySelectorAll('.question-type-btn');
                buttons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const type = btn.getAttribute('data-type');
                        if (this.enabledQuestionTypes.has(type)) {
                            this.enabledQuestionTypes.delete(type);
                            btn.classList.remove('active');
                        } else {
                            this.enabledQuestionTypes.add(type);
                            btn.classList.add('active');
                        }
                        this.totalQuestions = Object.keys(this.departments).length * this.enabledQuestionTypes.size;
                        
                        // Clear working set and wrong answer queue when types change
                        this.workingSet = [];
                        this.workingSetIndex = 0;
                        this.wrongAnswerQueue = [];
                        this.questionsSinceWrong = new Map();
                        
                        this.updateProgress();
                    });
                });
            }

            loadProgress() {
                const saved = localStorage.getItem('french_departments_progress');
                if (saved) {
                    return JSON.parse(saved);
                }
                
                const scores = {};
                for (const [dept] of Object.entries(this.departments)) {
                    scores[`${dept}:name-to-capital`] = 1;
                    scores[`${dept}:capital-to-name`] = 1;
                    scores[`${dept}:shape-to-name`] = 1;
                }
                return scores;
            }

            saveProgress() {
                localStorage.setItem('french_departments_progress', JSON.stringify(this.confidenceScores));
            }

            selectQuestion() {
                // Track the questions we got wrong recently - these get IMMEDIATE priority
                if (!this.wrongAnswerQueue) this.wrongAnswerQueue = [];
                if (!this.questionsSinceWrong) this.questionsSinceWrong = new Map();
                
                // Clean wrong answer queue - remove questions that aren't in enabled types anymore
                this.wrongAnswerQueue = this.wrongAnswerQueue.filter(q => this.enabledQuestionTypes.has(q.type));
                
                // Check if we have any wrong answers that need immediate review
                // Review wrong answers after just 1-3 other questions
                const readyForReview = this.wrongAnswerQueue.filter(q => {
                    const questionsSince = this.questionsSinceWrong.get(q.key) || 0;
                    return questionsSince >= Math.floor(Math.random() * 3) + 1; // 1-3 questions
                });
                
                if (readyForReview.length > 0) {
                    // Pick the one that's been waiting longest
                    const selected = readyForReview[0];
                    
                    // Remove from queue and reset counter
                    this.wrongAnswerQueue = this.wrongAnswerQueue.filter(q => q.key !== selected.key);
                    this.questionsSinceWrong.delete(selected.key);
                    
                    return selected;
                }
                
                // Increment counters for all questions in wrong answer queue
                for (const q of this.wrongAnswerQueue) {
                    const current = this.questionsSinceWrong.get(q.key) || 0;
                    this.questionsSinceWrong.set(q.key, current + 1);
                }
                
                // Separate questions by confidence level
                const level1 = []; // Don't know
                const level2 = []; // Very uncertain
                const level3 = []; // Somewhat confident
                const level4 = []; // Quite confident
                const level5 = []; // Completely confident
                
                for (const [dept, data] of Object.entries(this.departments)) {
                    for (const type of this.enabledQuestionTypes) {
                        const key = `${dept}:${type}`;
                        const confidence = this.confidenceScores[key];
                        const questionObj = {dept, capital: data.capital, number: data.number, type, key};
                        
                        if (confidence === 1) level1.push(questionObj);
                        else if (confidence === 2) level2.push(questionObj);
                        else if (confidence === 3) level3.push(questionObj);
                        else if (confidence === 4) level4.push(questionObj);
                        else if (confidence === 5) level5.push(questionObj);
                    }
                }
                
                // Create small working set (5-8 questions) from level 1
                if (!this.workingSet) this.workingSet = [];
                if (!this.workingSetIndex) this.workingSetIndex = 0;
                
                // If we have level 1 items, focus on small batches
                if (level1.length > 0) {
                    // Refresh working set if empty or outdated
                    if (this.workingSet.length === 0 || 
                        !this.workingSet.every(q => level1.some(l => l.key === q.key))) {
                        const batchSize = Math.min(5, level1.length); // Just 5 at a time!
                        // Shuffle level1 before selecting
                        const shuffled = [...level1].sort(() => Math.random() - 0.5);
                        this.workingSet = shuffled.slice(0, batchSize);
                        this.workingSetIndex = 0;
                    }
                    
                    // Cycle through working set
                    const selected = this.workingSet[this.workingSetIndex];
                    this.workingSetIndex = (this.workingSetIndex + 1) % this.workingSet.length;
                    
                    return selected;
                }
                
                // Level 2: small working set of 8
                if (level2.length > 0) {
                    if (this.workingSet.length === 0 || 
                        !this.workingSet.every(q => level2.some(l => l.key === q.key))) {
                        const batchSize = Math.min(8, level2.length);
                        // Shuffle level2 before selecting
                        const shuffled = [...level2].sort(() => Math.random() - 0.5);
                        this.workingSet = shuffled.slice(0, batchSize);
                        this.workingSetIndex = 0;
                    }
                    
                    const selected = this.workingSet[this.workingSetIndex];
                    this.workingSetIndex = (this.workingSetIndex + 1) % this.workingSet.length;
                    
                    return selected;
                }
                
                // For level 3+, mix them up more
                const pool = [...level3, ...level4, ...level5];
                
                if (pool.length === 0) return null;
                
                // Avoid same question twice in a row
                if (!this.lastQuestion) this.lastQuestion = null;
                
                let selected;
                let attempts = 0;
                do {
                    selected = pool[Math.floor(Math.random() * pool.length)];
                    attempts++;
                } while (attempts < 20 && pool.length > 1 && this.lastQuestion && selected.key === this.lastQuestion.key);
                
                this.lastQuestion = selected;
                return selected;
            }

            checkAnswerMatch(userAnswer, correctAnswer) {
                const userClean = userAnswer.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                const correctClean = correctAnswer.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                
                if (userClean === correctClean) return true;
                if (userClean.length > 3 && correctClean.includes(userClean)) return true;
                
                const alternates = {'saint': 'st', 'sainte': 'ste'};
                for (const [full, abbr] of Object.entries(alternates)) {
                    if (userClean.includes(full) && correctClean.includes(abbr)) return true;
                    if (userClean.includes(abbr) && correctClean.includes(full)) return true;
                }
                
                return false;
            }

            updateProgress() {
                const confidenceCounts = [0, 0, 0, 0, 0, 0];
                let totalEnabled = 0;
                
                for (const [dept] of Object.entries(this.departments)) {
                    for (const type of this.enabledQuestionTypes) {
                        const key = `${dept}:${type}`;
                        const confidence = this.confidenceScores[key];
                        confidenceCounts[confidence]++;
                        totalEnabled++;
                    }
                }
                
                const mastered = confidenceCounts[5];
                const percentage = totalEnabled > 0 ? Math.round((mastered / totalEnabled) * 100) : 0;
                
                document.getElementById('progressFill').style.width = percentage + '%';
                document.getElementById('progressText').textContent = `Mastered: ${mastered}/${totalEnabled} (${percentage}%)`;
                
                for (let i = 1; i <= 5; i++) {
                    document.getElementById(`stat${i}`).textContent = confidenceCounts[i];
                }
                
                if (totalEnabled > 0 && mastered === totalEnabled) {
                    document.getElementById('completionMessage').classList.remove('hidden');
                    document.getElementById('flashcardSection').classList.add('hidden');
                }
            }

            getDepartmentShape(deptName) {
                return this.departmentPaths[deptName] || null;
            }

            displayQuestion() {
                const question = this.selectQuestion();
                if (!question) return;
                
                this.currentQuestion = question;
                this.isCorrect = false;
                this.showedAnswer = false;
                
                const imageContainer = document.getElementById('imageContainer');
                imageContainer.innerHTML = '';
                
                let questionText = '';
                
                if (question.type === 'name-to-capital') {
                    const deptPhonetic = this.phonetics[question.dept] || '';
                    questionText = `What is the capital of ${question.dept}${deptPhonetic ? ` (${deptPhonetic})` : ''}?`;
                } else if (question.type === 'capital-to-name') {
                    const capitalPhonetic = this.phonetics[question.capital] || '';
                    questionText = `${question.capital}${capitalPhonetic ? ` (${capitalPhonetic})` : ''} is the capital of which department?`;
                } else if (question.type === 'shape-to-name') {
                    questionText = `What is the name of this department?`;
                    
                    const shapePath = this.getDepartmentShape(question.dept);
                    
                    if (shapePath) {
                        const svgContainer = document.createElement('div');
                        svgContainer.className = 'department-shape-container';
                        
                        const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                        svg.setAttribute('class', 'department-shape-svg');
                        svg.setAttribute('viewBox', this.mapData.viewBox);
                        
                        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                        path.setAttribute('d', shapePath);
                        
                        svg.appendChild(path);
                        svgContainer.appendChild(svg);
                        imageContainer.appendChild(svgContainer);
                    } else {
                        // Fallback
                        const deptBox = document.createElement('div');
                        deptBox.className = 'department-shape-container';
                        deptBox.style.cssText = 'display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px';
                        
                        const numberBadge = document.createElement('div');
                        numberBadge.style.cssText = 'font-size:4em;font-weight:bold;color:#0055A4;background:white;border:4px solid #0055A4;border-radius:50%;width:150px;height:150px;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(0,85,164,0.3)';
                        numberBadge.textContent = question.number;
                        
                        const hintText = document.createElement('div');
                        hintText.style.cssText = 'font-size:1.2em;color:#718096;font-style:italic';
                        hintText.textContent = `Department #${question.number}`;
                        
                        deptBox.appendChild(numberBadge);
                        deptBox.appendChild(hintText);
                        imageContainer.appendChild(deptBox);
                    }
                }
                
                document.getElementById('currentQuestion').textContent = questionText;
                const answerInput = document.getElementById('answerInput');
                answerInput.value = '';
                answerInput.classList.remove('correct', 'incorrect');
                answerInput.disabled = false;
                answerInput.focus();
                
                document.getElementById('resultSection').classList.add('hidden');
                document.getElementById('resultSection').innerHTML = '';
                
                // Disable confidence buttons except "Don't know"
                const confidenceButtons = document.querySelectorAll('.confidence-btn');
                confidenceButtons.forEach(btn => {
                    if (btn.id === 'dontKnowBtn') {
                        btn.disabled = false;
                    } else {
                        btn.disabled = true;
                    }
                });
            }

            enableConfidenceButtons() {
                const confidenceButtons = document.querySelectorAll('.confidence-btn');
                confidenceButtons.forEach(btn => btn.disabled = false);
            }
        }

        let game;
        
        try {
            game = new FrenchDepartmentsFlashcards(franceDepartments);
            window.game = game;
            game.displayQuestion();
        } catch (error) {
            console.error('Error loading map:', error);
            document.getElementById('loadingMessage').textContent = 'Error loading map data. Please refresh the page.';
        }

        window.checkAnswer = function() {
            if (!game || !game.currentQuestion) return;
            
            const userInput = document.getElementById('answerInput').value.trim();
            const resultSection = document.getElementById('resultSection');
            const answerInput = document.getElementById('answerInput');
            
            if (userInput === '') {
                resultSection.innerHTML = `⚠️ Please type an answer`;
                resultSection.className = 'result';
                resultSection.classList.remove('hidden');
                return;
            }
            
            let correctAnswer = '';
            if (game.currentQuestion.type === 'name-to-capital') {
                correctAnswer = game.currentQuestion.capital;
            } else {
                correctAnswer = game.currentQuestion.dept;
            }
            
            const isCorrect = game.checkAnswerMatch(userInput, correctAnswer);
            
            if (isCorrect) {
                game.isCorrect = true;
                answerInput.classList.add('correct');
                answerInput.classList.remove('incorrect');
                answerInput.disabled = true;
                
                // ALWAYS automatically move on if they used "Don't know" or got it wrong before
                if (game.showedAnswer) {
                    game.confidenceScores[game.currentQuestion.key] = 1;
                    game.saveProgress();
                    game.updateProgress();
                    
                    resultSection.innerHTML = `✅ Correct! Moving to next question...`;
                    resultSection.className = 'result correct';
                    resultSection.classList.remove('hidden');
                    
                    setTimeout(() => {
                        game.displayQuestion();
                    }, 800);
                } else {
                    // Only ask for confidence if they got it right on first try
                    resultSection.innerHTML = `✅ Correct! Now rate your confidence to continue.`;
                    resultSection.className = 'result correct';
                    resultSection.classList.remove('hidden');
                    
                    // Enable confidence buttons
                    game.enableConfidenceButtons();
                }
            } else {
                // WRONG ANSWER - Add to immediate review queue
                if (!game.wrongAnswerQueue) game.wrongAnswerQueue = [];
                if (!game.questionsSinceWrong) game.questionsSinceWrong = new Map();
                
                // Add to queue if not already there
                if (!game.wrongAnswerQueue.some(q => q.key === game.currentQuestion.key)) {
                    game.wrongAnswerQueue.push({...game.currentQuestion});
                    game.questionsSinceWrong.set(game.currentQuestion.key, 0);
                }
                
                // Mark that we showed the answer (so next time it's correct, auto-move on)
                game.showedAnswer = true;
                
                answerInput.classList.add('incorrect');
                answerInput.classList.remove('correct');
                
                const phonetic = game.phonetics[correctAnswer] || '';
                resultSection.innerHTML = `❌ Incorrect. The correct answer is: <strong>${correctAnswer}${phonetic ? ` (${phonetic})` : ''}</strong><br>Please type it correctly to continue.`;
                resultSection.className = 'result incorrect';
                resultSection.classList.remove('hidden');
                
                // Clear the input for retry
                answerInput.value = '';
                answerInput.focus();
            }
        };

        window.setConfidence = function(level) {
            if (!game || !game.currentQuestion) return;
            
            // If "Don't know" is clicked and answer hasn't been shown yet
            if (level === 1 && !game.showedAnswer) {
                let correctAnswer = '';
                if (game.currentQuestion.type === 'name-to-capital') {
                    correctAnswer = game.currentQuestion.capital;
                } else {
                    correctAnswer = game.currentQuestion.dept;
                }
                
                const phonetic = game.phonetics[correctAnswer] || '';
                const resultSection = document.getElementById('resultSection');
                const answerInput = document.getElementById('answerInput');
                
                resultSection.innerHTML = `ℹ️ The correct answer is: <strong>${correctAnswer}${phonetic ? ` (${phonetic})` : ''}</strong><br>Please type it in to continue.`;
                resultSection.className = 'result';
                resultSection.classList.remove('hidden');
                
                game.showedAnswer = true;
                answerInput.focus();
                return;
            }
            
            // Normal flow - only proceed if answer is correct
            if (!game.isCorrect) return;
            
            game.confidenceScores[game.currentQuestion.key] = level;
            game.saveProgress();
            game.updateProgress();
            
            const resultSection = document.getElementById('resultSection');
            resultSection.innerHTML += `<br><strong>Confidence level ${level} recorded!</strong>`;
            
            setTimeout(() => {
                game.displayQuestion();
            }, 800);
        };

        window.startSession = function() {
            document.getElementById('completionMessage').classList.add('hidden');
            document.getElementById('flashcardSection').classList.remove('hidden');
            if (game) game.displayQuestion();
        };

        document.getElementById('answerInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                window.checkAnswer();
            }
        });
    </script>
</body>
</html>
